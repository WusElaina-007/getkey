<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>Verify Key</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      background: radial-gradient(circle at top, #0b1220, #030712);
      font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      color: #e5e7eb;
    }
    .card {
      width: 100%;
      max-width: 420px;
      background: rgba(255,255,255,0.04);
      border: 1px solid rgba(255,255,255,0.08);
      border-radius: 16px;
      padding: 24px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.5);
      backdrop-filter: blur(8px);
    }
    h1 {
      margin: 0 0 12px;
      font-size: 22px;
      text-align: center;
    }
    .status {
      margin-top: 12px;
      font-size: 14px;
      color: #9ca3af;
      text-align: center;
      min-height: 20px;
    }
    .key-box {
      margin-top: 16px;
      padding: 14px;
      border-radius: 12px;
      background: #020617;
      border: 1px dashed #2563eb;
      font-family: monospace;
      font-size: 15px;
      text-align: center;
      word-break: break-all;
      display: none;
    }
    .btn {
      margin-top: 16px;
      width: 100%;
      padding: 12px;
      border-radius: 12px;
      border: none;
      background: linear-gradient(135deg, #2563eb, #4f46e5);
      color: #fff;
      font-size: 15px;
      cursor: pointer;
    }
    .btn:active { transform: scale(0.98); }
  </style>
</head>

<body>
  <div class="card">
    <h1>üîê X√°c minh key</h1>
    <div id="status" class="status">ƒêang ki·ªÉm tra key‚Ä¶</div>

    <div id="keyBox" class="key-box"></div>

    <button id="copyBtn" class="btn" style="display:none">üìã Copy key</button>
  </div>

<script>
  // ‚ö†Ô∏è S·ª¨A ƒê√öNG WORKER VERIFY C·ª¶A B·∫†N
  const VERIFY_API = "https://key-vuotnhanh-api.yeudaushope.workers.dev/api/verify";

  const statusEl = document.getElementById("status");
  const keyBox   = document.getElementById("keyBox");
  const copyBtn  = document.getElementById("copyBtn");

  // =========================
  // L·∫§Y KEY T·ª™ URL
  // =========================
  function extractKey() {
    const sp = new URLSearchParams(location.search);

    // case 1: ?key=
    let key = sp.get("key");
    if (key) return key;

    // case 2: key n·∫±m trong passed
    let passed = sp.get("passed");
    if (!passed) return null;

    passed = passed.trim().replace(/^1+/, "");
    const i = passed.indexOf("http");
    if (i > 0) passed = passed.slice(i);

    const m = passed.match(/[?&]key=([A-Z0-9]+)/i);
    return m ? m[1] : null;
  }

  const key = extractKey();
  if (!key) {
    statusEl.textContent = "‚ùå Kh√¥ng t√¨m th·∫•y key trong URL";
    throw new Error("Missing key");
  }

  // =========================
  // VERIFY KEY
  // =========================
  fetch(`${VERIFY_API}?key=${encodeURIComponent(key)}`)
    .then(r => r.json())
    .then(d => {
      if (!d.ok) {
        statusEl.textContent = "‚ùå " + (d.error || "Verify th·∫•t b·∫°i");
        return;
      }

      statusEl.textContent = `‚úÖ Key h·ª£p l·ªá ¬∑ c√≤n ${d.time_left}s`;
      keyBox.textContent = d.key;
      keyBox.style.display = "block";
      copyBtn.style.display = "block";
    })
    .catch(err => {
      statusEl.textContent = "‚ùå L·ªói k·∫øt n·ªëi API";
      console.error(err);
    });

  // =========================
  // COPY
  // =========================
  copyBtn.onclick = () => {
    navigator.clipboard.writeText(keyBox.textContent);
    copyBtn.textContent = "‚úÖ ƒê√£ copy";
    setTimeout(() => copyBtn.textContent = "üìã Copy key", 1200);
  };
</script>
</body>
</html>
