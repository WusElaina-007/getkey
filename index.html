<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Get Key</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{
  margin:0;
  font-family:system-ui,-apple-system;
  background:radial-gradient(circle at top,#1d2f5a,#070b16);
  color:#fff;
  display:flex;
  align-items:center;
  justify-content:center;
  height:100vh;
}
.box{
  width:90%;
  max-width:380px;
  background:rgba(255,255,255,.06);
  backdrop-filter:blur(16px);
  border-radius:18px;
  padding:26px;
  box-shadow:0 30px 80px rgba(0,0,0,.45);
  text-align:center;
  animation:pop .35s ease;
}
@keyframes pop{
  from{transform:scale(.92);opacity:0}
  to{transform:scale(1);opacity:1}
}
button{
  width:100%;
  padding:14px;
  border:none;
  border-radius:14px;
  font-size:16px;
  font-weight:600;
  cursor:pointer;
  background:linear-gradient(135deg,#5aa2ff,#6bffe2);
  color:#000;
}
.key{
  margin-top:16px;
  padding:14px;
  background:#000;
  border-radius:12px;
  font-family:monospace;
  word-break:break-all;
  font-size:14px;
}
.hint{
  opacity:.8;
  font-size:13px;
  margin-top:10px;
}
</style>
</head>

<body>
<div class="box">
  <h2>üîë GET KEY</h2>
  <p>Nh·∫•n n√∫t ‚Üí v∆∞·ª£t link ‚Üí nh·∫≠n key</p>

  <button onclick="goVuot()">üöÄ L·∫§Y KEY</button>

  <div id="keyBox" class="key" style="display:none"></div>
  <div class="hint" id="hint"></div>
</div>

<script type="module">
/* ================== CONFIG ================== */
const VUOTNHANH_API = "ff60b470-d49a-4c0c-89e2-968102e9efab";
const RETURN_URL = "https://wuselaina-007.github.io/getkey/?passed=1";

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import {
  getFirestore, doc, setDoc, serverTimestamp
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyDR73HZ6MyMF5GRgw3bx_c7vExGuGmzLs4",
  projectId: "key-tool-bb37b"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

/* ================== FUNCTIONS ================== */
function genKey(){
  return "HK-" + crypto.randomUUID().replace(/-/g,"").toUpperCase();
}

async function saveKey(key){
  await setDoc(doc(db,"keys",key),{
    created_at: serverTimestamp(),
    used: 0,
    max_uses: 1,
    source: "vuotnhanh"
  });
}

/* ================== VUOTNHANH API ================== */
window.goVuot = async () => {
  try{
    const apiUrl =
      "https://vuotnhanh.com/api"
      + "?api=" + encodeURIComponent(VUOTNHANH_API)
      + "&url=" + encodeURIComponent(RETURN_URL);

    const res = await fetch(apiUrl);
    const text = await res.text();

    // TEXT response
    if(text.startsWith("http")){
      location.href = text.trim();
      return;
    }

    // JSON response
    const data = JSON.parse(text);
    if(data.status === "success"){
      location.href = data.shortenedUrl;
    }else{
      alert("VuotNhanh error: " + data.message);
    }
  }catch(e){
    alert("L·ªói g·ªçi VuotNhanh API");
    console.error(e);
  }
};

/* ================== CALLBACK ================== */
const params = new URLSearchParams(location.search);
if(params.get("passed")==="1"){
  const key = genKey();
  await saveKey(key);

  const box = document.getElementById("keyBox");
  box.style.display="block";
  box.textContent=key;

  document.getElementById("hint").textContent =
    "Key ƒë√£ copy ‚Äì d√°n v√†o tool ƒë·ªÉ login";

  navigator.clipboard.writeText(key);
}
</script>
</body>
</html>
